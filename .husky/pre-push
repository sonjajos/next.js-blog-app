#!/usr/bin/env sh
set -e
. "$(dirname -- "$0")/_/husky.sh"

read local_ref local_sha remote_ref remote_sha
REMOTE_BRANCH=${remote_ref#refs/heads/}
BRANCH=$(git symbolic-ref --short HEAD)

if [ "$REMOTE_BRANCH" = "main" ] || [ "$REMOTE_BRANCH" = "develop" ]; then
  echo "‚ùå Pushing directly to '$REMOTE_BRANCH' is NOT allowed!"
  exit 1
fi

if echo "$BRANCH" | grep -Eq '^(feature|fix|improvement|hotfix|release|refactor|test|docs|chore)/'; then
  echo "‚úÖ Branch name '$BRANCH' is valid."
  echo "üü† Running tests..."
  npm test
  echo "‚è∫Ô∏è Running build command..."
  npm run build
else
  echo "‚ùå Invalid branch name: '$BRANCH'"
  echo "üîí Branch must start with one of: feature/, fix/, improvement/, hotfix/, release/, refactor/, test/, docs/, chore/"
  exit 1
fi
